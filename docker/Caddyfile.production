{
    frankenphp {
        num_threads 4
    }

    auto_https off
    servers {
        trusted_proxies static private_ranges
    }
}

:80 {
    root * /app/public

    encode gzip

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        X-Frame-Options "SAMEORIGIN"
        Referrer-Policy "strict-origin-when-cross-origin"
        -Server
    }

    respond /health 200

    php_server {
        worker /app/public/frankenphp-worker.php
        num_workers 4
    }

    @static {
        file
        path *.css *.js *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot
    }
    handle @static {
        header Cache-Control "public, max-age=31536000"
        file_server
    }

    @forbidden {
        path /.env* /composer.* /package.* /.git* /storage/* /tests/*
    }
    respond @forbidden 404

    log {
        output file /var/log/caddy/access.log
        format json
    }
}
